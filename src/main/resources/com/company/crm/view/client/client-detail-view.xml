<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<view xmlns="http://jmix.io/schema/flowui/view" xmlns:dynattr="http://jmix.io/schema/dynattr/flowui"
      title="msg://clientDetailView.title">
    <data>
        <instance id="clientDc"
                  class="com.company.crm.model.client.Client">
            <fetchPlan extends="_base">
                <property name="accountManager" fetchPlan="_base"/>
                <property name="contacts" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="clientDl"/>
            <collection id="contactsDc" property="contacts"/>
        </instance>
        <collection id="ordersDc" class="com.company.crm.model.order.Order">
            <fetchPlan extends="_base">
                <property name="orderItems" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="ordersDl">
                <query>
                    <![CDATA[select e from Order_ e where e.client = :container_clientDc]]>
                </query>
            </loader>
        </collection>
        <collection id="invoicesDc" class="com.company.crm.model.invoice.Invoice">
            <fetchPlan extends="_base"/>
            <loader id="invoicesDl">
                <query>
                    <![CDATA[select e from Invoice e where e.client = :container_clientDc]]>
                </query>
            </loader>
        </collection>
        <collection id="paymentsDc" class="com.company.crm.model.payment.Payment">
            <fetchPlan extends="_base">
                <property name="invoice" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="paymentsDl">
                <query>
                    <![CDATA[select e from Payment e where e.invoice.client = :container_clientDc]]>
                </query>
            </loader>
        </collection>
        <collection id="activitiesDc" class="com.company.crm.model.user.activity.UserActivity">
            <fetchPlan extends="_base">
                <property name="user" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="activitiesDl" readOnly="true"/>
        </collection>
    </data>
    <facets>
        <dataLoadCoordinator auto="true"/>
        <urlQueryParameters id="urlQueryParameters"/>
        <dynattr:dynamicAttributes/>
    </facets>
    <actions>
        <action id="saveCloseAction" type="detail_saveClose" text="msg:///actions.Save"/>
        <action id="closeAction" type="detail_close" text="msg:///actions.Close" icon="vaadin:close"/>
        <action id="downloadProfile" text="msg://downloadProfile" icon="vaadin:download-alt" actionVariant="SUCCESS"/>
    </actions>
    <layout>
        <hbox padding="true" width="100%" justifyContent="BETWEEN" alignItems="CENTER">
            <h2 id="companyName" dataContainer="clientDc" property="name" classNames="ml-m"/>
            <hbox id="detailActions">
                <button id="saveAndCloseButton" action="saveCloseAction"/>
                <button id="closeButton" action="closeAction"/>
                <button id="downloadProfileButton" action="downloadProfile"/>
            </hbox>
        </hbox>
        <scroller width="100%" height="100%">
            <div width="100%" height="100%">
                <tabSheet id="tabSheet" width="100%">
                    <tab id="infoTab" label="msg://infoTabLabel">
                        <div width="100%">
                            <formLayout id="chartsBlock" width="100%" classNames="mb-m mt-m">
                                <responsiveSteps>
                                    <responsiveStep minWidth="0" columns="1"/>
                                    <responsiveStep minWidth="60em" columns="3"/>
                                </responsiveSteps>
                            </formLayout>

                            <split width="100%" id="formSplit" themeNames="minimal" splitterPosition="70">
                                <vbox padding="false" classNames="pr-m" maxWidth="55em">
                                    <formLayout id="form" dataContainer="clientDc">
                                        <responsiveSteps>
                                            <responsiveStep minWidth="0" columns="1"/>
                                            <responsiveStep minWidth="40em" columns="2"/>
                                        </responsiveSteps>
                                        <h3 text="Common" classNames="pt-l" colspan="2"/>
                                        <textField id="nameField" property="name"/>
                                        <select id="typeField" property="type"/>
                                        <textField id="fullNameField" property="fullName"/>
                                        <textField id="vatNumberField" property="vatNumber"/>
                                        <textField id="websiteField" property="website"/>
                                        <textField id="regNumberField" property="regNumber"/>

                                        <h3 text="msg://com.company.crm.model.address/Address" classNames="pt-l"
                                            colspan="2"/>
                                        <formLayout id="addressForm" expandColumns="true" expandFields="true"
                                                    maxColumns="2"
                                                    colspan="2" dataContainer="clientDc">
                                            <textField property="address.country"/>
                                            <textField property="address.building"/>
                                            <textField property="address.city"/>
                                            <textField property="address.apartment"/>
                                            <textField property="address.street"/>
                                            <textField property="address.postalCode"/>
                                        </formLayout>
                                    </formLayout>
                                </vbox>

                                <vbox width="100%" padding="false" alignItems="CENTER" classNames="pl-m" maxWidth="30em">
                                    <formLayout dataContainer="clientDc" alignSelf="CENTER">
                                        <responsiveSteps>
                                            <responsiveStep minWidth="0" columns="1"/>
                                        </responsiveSteps>
                                        <h3 text="msg://managementTitle" classNames="pt-l"/>
                                        <entityPicker id="accountManagerField" property="accountManager"
                                                      readOnly="true" classNames="pb-l"/>
                                        <component id="recentActivities"
                                                   class="com.company.crm.app.ui.component.RecentActivitiesBlock">
                                            <properties>
                                                <property name="border" value="true"/>
                                            </properties>
                                        </component>
                                    </formLayout>
                                </vbox>
                            </split>
                        </div>
                    </tab>

                    <tab id="contactsTab" label="msg://contactsTabLabel">
                        <vbox width="100%" height="100%">
                            <hbox id="buttonsPanel" classNames="buttons-panel">
                                <startSlot>
                                    <button id="createButton" action="contactsDataGrid.createAction"/>
                                    <button id="editButton" action="contactsDataGrid.editAction"/>
                                    <button id="removeButton" action="contactsDataGrid.removeAction"/>
                                </startSlot>
                            </hbox>
                            <dataGrid id="contactsDataGrid" dataContainer="contactsDc" multiSort="true">
                                <actions>
                                    <action id="createAction" type="list_create"/>
                                    <action id="editAction" type="list_edit"/>
                                    <action id="removeAction" type="list_remove"/>
                                </actions>
                                <columns sortable="true">
                                    <column property="position"/>
                                    <column property="email"/>
                                    <column property="phone"/>
                                </columns>
                            </dataGrid>
                        </vbox>
                    </tab>

                    <tab id="ordersTab" label="msg://ordersTabLabel">
                        <vbox width="100%" height="100%">
                            <dataGrid id="ordersDataGrid" dataContainer="ordersDc" multiSort="true">
                                <columns sortable="true">
                                    <column property="status" filterable="true"/>
                                    <column property="date"/>
                                    <column property="total"/>
                                </columns>
                            </dataGrid>
                        </vbox>
                    </tab>

                    <tab id="invoicesTab" label="msg://invoicesTabLabel">
                        <vbox width="100%" height="100%">
                            <dataGrid id="invoicesDataGrid" dataContainer="invoicesDc" multiSort="true">
                                <columns sortable="true">
                                    <column property="status" filterable="true"/>
                                    <column property="date" filterable="true"/>
                                    <column property="dueDate" filterable="true"/>
                                </columns>
                            </dataGrid>
                        </vbox>
                    </tab>

                    <tab id="paymentsTab" label="msg://paymentsTabLabel">
                        <vbox width="100%" height="100%">
                            <dataGrid id="paymentsDataGrid" dataContainer="paymentsDc" multiSort="true">
                                <columns sortable="true">
                                    <column property="invoice" filterable="true"/>
                                    <column property="date" filterable="true"/>
                                    <column property="amount" filterable="true"/>
                                </columns>
                            </dataGrid>
                        </vbox>
                    </tab>

                    <tab id="activitiesTab" label="msg://activitiesTabLabel">
                        <vbox width="100%" height="100%">
                            <dataGrid id="activitiesDataGrid" dataContainer="activitiesDc" multiSort="true">
                                <columns sortable="true">
                                    <column property="actionDescription" filterable="true"/>
                                </columns>
                            </dataGrid>
                        </vbox>
                    </tab>
                </tabSheet>
            </div>
        </scroller>
    </layout>
</view>
